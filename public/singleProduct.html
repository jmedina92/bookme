<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
  		<link rel="stylesheet" href="/web/css/bootstrap-datepicker.css">
	</head>
	<body>
		<div id="navbar"></div>
		<div class="container">
			<div class="jumbotron">
				<h3 class="name-equip"></h3>
				<div style="width:45%; display:inline-block;vertical-align: top; margin-right:7%;">
					<table class="table table-equipments">
						<thead>
							<tr>
								<th>Unit Time (Hours)</th>	
								<th>Max Time (Hours)</th>	
								<th>Price per Hour(â‚¬)</th>	
							</tr>
						</thead>
						<tbody>
						</tbody>
					</table>
				</div>
				<div style="width:45%; display:inline-block;">
					<div class="date-input"><h4>Date to book:</h4>
						<form class="form-date">
							<input name="product-date" type="text" id="datepicker">
						</form>
					</div>
				</div>
				<div class="calendar"></div>
			</div>
		</div>
	</body>
</html>

<script type="text/javascript" src="dpd.js"></script>
<script src="/web/js/bootstrap-datepicker.js"></script>
<script>
var query;
	$(document).ready(function(){
		$('head').load('/layout/fluid.html');
        $('#navbar').load('/layout/navbar.html');
		loadEquipment();
		$( "#datepicker" ).datepicker({
			format: "dd.mm.yyyy",
			keyboardNavigation: false
		})
		.on('changeDate', function(e) {
		  	$('.form-date').submit();
		});

	});

	$('.form-date').on('submit', function(e){
		e.preventDefault();
		date = $('#datepicker').val();
		dpd.bookings.get({itemId: query.id}, function(bookings, error){
			if(!error){
				bookings.forEach(function(booking){
					initDate = new Date(booking.initDate * 1000);
					alert(initDate.getDate());
					
				})
			}
		})

	})

	function loadEquipment(){
		query = getQueryParams();
		dpd.equipments.get(query.id, function(equipment, error){
			unitTime = equipment.unitTime / 3600;
			if (equipment.maxTime) maxTime = equipment.maxTime / 3600;
			else maxTime = '-';
			$('.name-equip').append(equipment.name);
			$('.table-equipments tbody').append('<tr><td>' + unitTime + '</td><td>' + maxTime + '</td><td>' + equipment.unitPrice + '</tr>');
		});
	}

	function getQueryParams() {
	    qs = document.location.search.split('+').join(' ');
	    var params = {},
	        tokens,
	        re = /[?&]?([^=]+)=([^&]*)/g;
	    while (tokens = re.exec(qs)) {
	        params[decodeURIComponent(tokens[1])] = decodeURIComponent(tokens[2]);
	    }
    return params;
}


</script>